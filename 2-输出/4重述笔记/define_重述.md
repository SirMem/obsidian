---
due: 2023-11-14
title: C预处理器和C库_卡片
tags:
  - C语言
  - 重述
---
# 🤔问题:
## define的用途是什么
提高代码的可读性和可维护性

# 🤔相关联:
[[预处理器_重述]]
# 📘自我重述
## define
### 组成
每行#define(逻辑行)都由三个部分组成。分别是#define指令本身，宏，和替换体。
![[nPpXHawlbwqKtrsN-a4fb2d05-25c9-e6f9-f517-cd04f7fb2548.png|704]]
### 宏
#### 类对象宏
一般来说，一些代替值的宏，如变量，指针等，被称为类对象宏。
#### 类函数宏
![[nPpXHawlbwqKtrsN-8d7d9a38-23b6-5133-c77f-86467d8953f0.png|614]]
带有形参的宏，称为类函数宏。其参数在替代体中出现。

#### 命名规则
只能使用字符、数字和下划线字符，而且首字符不能是数字。
#### 宏展开
从宏变成最终替换文本的过程称为宏展开
#### 小心双引号
声明一个宏
```c
#define OW "Consistency is the last refuge of the unimagina\
tive.- Oscar Wilde"
```
一般而言，预处理器发现程序中的宏后，会用宏等价的替换文本进行替换。如果替换的字符串中还包含宏，则继续替换这些宏。唯一例外的是双引号中的宏。
如果是printf("TWO: OW");打印的是TWO: OW
应该这样写printf("%d: %s\n", TWO, OW); 这行代码中，宏不在双引号内。
### 替换体
一旦预处理器在程序中找到宏的示实例后，就会用替换体代替该宏。替换体可以是常量，字符，字符串，函数等等。
## 何时使用define
### 助记
助记、易更改、可移植，这些都是符号常量很有价值的特性。对于绝大部分数字常量，应该使用字符常量。
### C静态数组的特征
在C中，非自动数组的大小应该是整型常量表达式，也就是说数组大小必须是枚举常量，整型常量和sizeof表达式，不包括const声明的值。(C++可以用)
```c
#define LIMIT 20
const int LIM = 50;
static int data1[LIMIT]; // 有效
static int data2[LIM]; // 无效
```
## 预处理器运算符
### 宏延续运算符（\\  ）
一个宏通常写在一个单行上。但是如果宏太长，一个单行容纳不下，则使用宏延续运算符。
```c
#define  message_for(a, b)  \
    printf(#a " and " #b ": We love you!\n")
```
### 字符串常量化运算符（#）
在宏定义中，当需要把一个宏的参数转换为字符串常量时，则使用字符串常量化运算符（#）。在宏中使用的该运算符有一个特定的参数或参数列表。
```c
#include <stdio.h>
 
#define  message_for(a, b)  \
    printf(#a " and " #b ": We love you!\n")
 
int main(void)
{
   message_for(Carole, Debra);
   return 0;
}
```
### 标记粘贴运算符（##）
宏定义内的标记粘贴运算符（##）会合并两个参数。它允许在宏定义中两个独立的标记被合并为一个标记。
```c
#include <stdio.h>
 
#define tokenpaster(n) printf ("token" #n " = %d", token##n)
 
int main(void)
{
   int token34 = 40;
   
   tokenpaster(34);
   return 0;
}

token34 = 40 //编译结果

```
## 类函数宏和函数的选择
宏和函数的选择实际上是时间和空间的权衡。宏生成内联代码，即在程序中生成语句。如果调用20次宏，即在程序中插入20行代码。如果调用函数20次，程序中只有一份函数语句的副本，所以节省了空间。然而另一方面，程序的控制必须跳转至函数内，随后再返回主调程序，这显然比内联代码花费更多的时间。

### 宏的优点
宏的一个优点是，不用担心变量类型（这是因为宏处理的是字符串，而不是实际的值）。
```c
#define SQUARE(X) (X)*(X); //int或float类型都可以使用SQUARE(x)宏
```

### 一些简单函数通常使用的宏
```c
#define MAX(X,Y) ((X) > (Y) ? (X) : (Y))  //如果x大于y返回x否则返回y
#define ABS(X) ((X) < 0 ? -(X) : (X))     // 绝对值
#define ISSIGN(X) ((X) == '+' || (X) == '-' ? 1 : 0) //判断符号
```
# 📒相关文章




# 🍏引用链接

